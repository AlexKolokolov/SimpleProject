<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a="http://xmlns.jcp.org/jsf/passthrough">

	<h:head>
		<title>Employee manager</title>
	</h:head>
	<h:body>
		<h1>Employee manager</h1>
		<ui:include src="logout.xhtml" />
		<fieldset>
			<legend>Employees</legend>
			<h:panelGroup id="allEmployees">
				<h:dataTable value="#{employeeDataController.employees}" var="employee">
					<h:column>
						<f:facet name="header">ID</f:facet>
							#{employee.id}
					</h:column>
					<h:column>
						<f:facet name="header">First name</f:facet>
							#{employee.firstName}
					</h:column>
					<h:column>
						<f:facet name="header">Last name</f:facet>
							#{employee.lastName}
					</h:column>
					<h:column>
						<f:facet name="header">Age</f:facet>
							#{employee.age}
					</h:column>
					<h:column>
						<f:facet name="header">Department</f:facet>
							#{employee.department.name}
					</h:column>
					<h:column>
						<f:facet name="header">Salary</f:facet>
							#{employee.salary} USD
					</h:column>
					<h:column>
						<f:facet name="header">Status</f:facet>
							#{employee.status}
					</h:column>
					<h:column>
						<h:form>
							<h:commandButton value="Details" action="employee?faces-redirect=true">
								<f:setPropertyActionListener value="#{employee}" target="#{employeeDataController.employee}" />
							</h:commandButton>
						</h:form>
					</h:column>
					<h:column>
						<h:form>
							<h:commandButton value="Fire" type="submit" action="#{employeeRemoveController.removeEmployee}">
								<f:setPropertyActionListener value="#{employee}" target="#{employeeRemoveController.employeeToRemove}" />
								<f:ajax execute="@form" render="removeEmployeeMessage allEmployees emptyDeps" />
							</h:commandButton>
						</h:form>
					</h:column>
				</h:dataTable>
			</h:panelGroup>
			<h:outputText id="removeEmployeeMessage"
				value="#{employeeRemoveController.message}" />
		</fieldset>
		<br/>
		<fieldset>
			<legend>Add new employee</legend>
			<h:form>
				<h:inputText id="firstName"
					value="#{newEmployeeController.firstName}"
					a:placeholder="Enter first name" />
				<br/>
				<br/>
				<h:inputText id="lastName" value="#{newEmployeeController.lastName}"
					a:placeholder="Enter last name" />
				<br/>
				<br/>
				<h:selectOneRadio id="gender" value="#{newEmployeeController.gender}">
					<f:selectItem itemValue="MALE" itemLabel="Male" />
					<f:selectItem itemValue="FEMALE" itemLabel="Female" />
				</h:selectOneRadio>
				<br/>
				<h:selectOneMenu value="#{newEmployeeController.age}">
					<f:selectItems value="#{newEmployeeController.ages}" />
				</h:selectOneMenu>
				<br/>
				<br/>
				<h:outputLabel for="selectDepartment" value="Department" /><br/>
				<h:selectOneMenu id="selectDepartment" value="#{newEmployeeController.departmentId}">
					<f:selectItems value="#{newEmployeeController.departments}" />
					<f:ajax execute="@this" render="selectChief" />
				</h:selectOneMenu>
				<br/>
				<br/>
				<h:outputLabel for="selectChief" value="Chief" /><br/>
				<h:selectOneMenu id="selectChief" value="#{newEmployeeController.chiefId}">
					<f:selectItems value="#{newEmployeeController.collegues}" />
				</h:selectOneMenu>
				<br/>
				<br/>
				<h:outputLabel for="salary" value="Salary" /><br/>
				<h:inputText id="salary" value="#{newEmployeeController.salary}"
					a:placeholder="Set salary" />
				<br/>
				<br/>
				<br/>
				<h:commandButton value="Add employee" type="submit" action="#{newEmployeeController.addNewEmployee}">
					<f:ajax execute="@form" render="addEmployeeMessage allEmployees emptyDeps depStats" />
				</h:commandButton>
			</h:form>
			<h:outputText id="addEmployeeMessage"
				value="#{newEmployeeController.message}" />
		</fieldset>
		<br/>
		<fieldset>
			<legend>Empty departments</legend>
			<h:panelGroup id="emptyDeps">
				<ui:repeat value="#{departmentDataController.emptyDepartments}"
					var="emptyDepartment">
					<h:outputText value="#{emptyDepartment}" />
					<br/>
				</ui:repeat>
			</h:panelGroup>
		</fieldset>
		<br/>
		<fieldset>
			<legend>Departments statistics</legend>
			<h:panelGroup id="depStats">
				<h:dataTable value="#{departmentDataController.statistic}" var="stat">
					<h:column>
						<f:facet name="header">|Department|</f:facet>
							#{stat.department}
					</h:column>
					<h:column>
						<f:facet name="header">|Employees number|</f:facet>
						<h:outputText value="#{stat.employeesNumber}" style="center" />	
					</h:column>
					<h:column>
						<f:facet name="header">|Min salary|</f:facet>
							#{stat.minSalary}
					</h:column>
					<h:column>
						<f:facet name="header">|Max salary|</f:facet>
							#{stat.maxSalary}
					</h:column>
					<h:column>
						<f:facet name="header">|Total salary|</f:facet>
							#{stat.totalSalary}
					</h:column>
					<h:column>
						<f:facet name="header">|Average salary|</f:facet>
							#{stat.averageSalary}
					</h:column>
					<h:column>
						<f:facet name="header">|Women over 30 years old|</f:facet>
							#{stat.womenNumber}
					</h:column>
				</h:dataTable>
			</h:panelGroup>
		</fieldset>
	</h:body>
</html>

